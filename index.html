<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mag Hex Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mt-5">Mag Hex Generator</h1>

        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Mag</span>
            <select id="mag" class="form-control">
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>

        <div class="form-floating mb-3">
            <input type="text" id="def" class="form-control" placeholder="DEF Level">
            <label for="def">DEF Level</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" id="pow" class="form-control" placeholder="POW Level">
            <label for="pow">POW Level</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" id="dex" class="form-control" placeholder="DEX Level">
            <label for="dex">DEX Level</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" id="mind" class="form-control" placeholder="MIND Level">
            <label for="mind">MIND Level</label>
        </div>

        <button onclick="generateHex()" class="btn btn-primary mb-3">Generate</button>

        <h2 class="mt-5">Result:</h2>
        <div class="alert alert-danger" role="alert" style="display: none;" id="error-div">
            There was an error processing your input
        </div>
        <div class="alert alert-success" role="alert" style="display: none;" id="success-div">
            <p id="itemCode" class="mb-3"></p>
            <p id="parameters" class="mb-3"></p>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="mag_hex_gen.js"></script>
    <script>
        const magSelect = document.getElementById('mag');

        // Populate the dropdown with options from MAGS
        for (const mag of MAGS.flat()) {
            const [hexValue, name] = mag;
            const option = document.createElement('option');
            option.value = hexValue;
            option.textContent = `${hexValue} - ${name}`;
            magSelect.appendChild(option);
        }

        async function generateHex() {
            const mag = document.getElementById('mag').value.toUpperCase();
            const defLvl = parseInt(document.getElementById('def').value, 10);
            const powLvl = parseInt(document.getElementById('pow').value, 10);
            const dexLvl = parseInt(document.getElementById('dex').value, 10);
            const mindLvl = parseInt(document.getElementById('mind').value, 10);

            if (!MAGS.flat().some(item => item[0] === mag)) {
                alert("The selected Mag hex value does not exist in the table");
                return;
            }

            const isError = Number.isNaN(defLvl) || Number.isNaN(powLvl) || Number.isNaN(dexLvl) || Number.isNaN(mindLvl);

            if (isError) {
                document.getElementById('itemCode').innerText = "Error";
                document.getElementById('parameters').innerText = "There was an error processing your input.";
                
                var errorDiv = document.getElementById("error-div");
                if (errorDiv) {
                    errorDiv.style.display = 'block';
                }
                var successDiv = document.getElementById("success-div");
                if (successDiv) {
                    successDiv.style.display = 'none';
                }
            } else {
                const statList = [defLvl, powLvl, dexLvl, mindLvl];
                const levels = defLvl + powLvl + dexLvl + mindLvl;

                if (levels > 200) {
                    console.log("Warning, level exceeds 200");
                }

                const bytesList = ['02', mag, toHex(levels), 'D9'];
                for (const stat of statList) {
                    const [expByte, lvlByte] = levelToHexBytes(stat);
                    bytesList.push(expByte);
                    bytesList.push(lvlByte);
                }

                document.getElementById('itemCode').innerText = "Item Code: " + bytesList.slice(0, 3).join(", ");
                document.getElementById('parameters').innerText = "Parameters: " + bytesList.slice(3).join(", ");
                
                var errorDiv = document.getElementById("error-div");
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                }
                var successDiv = document.getElementById("success-div");
                if (successDiv) {
                    successDiv.style.display = 'block';
                }
            }
        }
    </script>
</body>
</html>